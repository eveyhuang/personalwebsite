---
import type { CollectionEntry } from "astro:content";

import BaseLayout from "./Base.astro";
import BlogHero from "@/components/blog/Hero";

interface Props {
	post: CollectionEntry<"post">;
}

const { post } = Astro.props;
const {
	data: { title, description, ogImage, publishDate },
	slug,
} = post;
const socialImage = ogImage ?? `/og-image/${slug}.png`;
const articleDate = publishDate.toISOString();
const { headings } = await post.render();
---

<BaseLayout meta={{ title, description, articleDate, ogImage: socialImage }}>
	<article class="grid gap-10 lg:grid-cols-[minmax(0,1fr)_220px]">
		<div>
			<BlogHero content={post} />
			<div class="article-body prose prose-editorial mt-10">
				<slot />
			</div>
		</div>
		{
			!!headings.length && (
				<aside class="order-first border-b border-line pb-5 lg:order-last lg:sticky lg:top-24 lg:border-b-0 lg:border-l lg:pl-4">
					<h2 class="meta-text">Table of Contents</h2>
					<ul class="mt-4 space-y-2 text-sm">
						{headings.map(({ depth, slug: headingSlug, text }) => (
							<li class:list={["text-muted", depth > 2 && "pl-3"]}>
								<a class="cactus-link" href={`#${headingSlug}`} aria-label={`Scroll to section: ${text}`}>
									{text}
								</a>
							</li>
						))}
					</ul>
				</aside>
			)
		}
	</article>
</BaseLayout>
